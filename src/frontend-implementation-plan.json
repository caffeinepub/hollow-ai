{
  "kind": "implementation_plan",
  "version": "1.0",
  "title": "Add save and share functionality for art and music",
  "requirements": [
    {
      "id": "REQ-31",
      "summary": "Add Save button to ArtCanvas for downloading artwork as PNG",
      "acceptanceCriteria": [
        "A clearly labeled 'Save' button is visible in the ArtCanvas component toolbar",
        "Clicking the Save button triggers a download of the current canvas content as a PNG file",
        "The downloaded file has a meaningful filename (e.g., 'axora-art-[timestamp].png')",
        "The saved image preserves the full canvas content and quality"
      ],
      "file_operations": [
        {
          "path": "frontend/src/components/ArtCanvas.tsx",
          "operation": "modify",
          "description": "Add a Save button to the toolbar that converts the canvas content to a PNG blob using canvas.toBlob() and triggers a browser download with a timestamped filename (e.g., 'axora-art-[timestamp].png'). Use URL.createObjectURL() and a temporary anchor element to initiate the download."
        }
      ]
    },
    {
      "id": "REQ-32",
      "summary": "Add Share button to ArtCanvas for generating shareable links",
      "acceptanceCriteria": [
        "A clearly labeled 'Share' button is visible in the ArtCanvas component toolbar",
        "Clicking the Share button uploads the canvas data to the backend and returns a unique identifier",
        "The user receives a shareable URL or code that can be copied to clipboard",
        "Shared artwork can be viewed by anyone with the link/code without requiring authentication"
      ],
      "file_operations": [
        {
          "path": "frontend/src/components/ArtCanvas.tsx",
          "operation": "modify",
          "description": "Add a Share button to the toolbar that converts canvas to PNG blob, creates an ExternalBlob using ExternalBlob.fromBytes(), generates a unique artwork ID, calls backend.shareArtwork(artworkId, externalBlob), and displays a shareable URL (e.g., '/shared/art/[artworkId]') with a copy-to-clipboard button. Use the blob-storage component to handle the upload. Verify the component's usage instructions before implementing. Show loading state during upload and success/error feedback."
        },
        {
          "path": "frontend/src/hooks/useArtworkShare.ts",
          "operation": "create",
          "description": "Create a custom hook that manages artwork sharing state and logic. Export functions for sharing artwork (converting canvas to blob, generating UUID, uploading via backend.shareArtwork), copying share URL to clipboard, and managing loading/error states. Use React Query for mutation handling and the blob-storage ExternalBlob class for upload operations."
        }
      ]
    },
    {
      "id": "REQ-34",
      "summary": "Add Save button to MusicGenerator for downloading audio as WAV",
      "acceptanceCriteria": [
        "A clearly labeled 'Save' button is visible in the MusicGenerator component interface",
        "Clicking the Save button triggers a download of the current audio as a WAV file",
        "The downloaded file has a meaningful filename (e.g., 'axora-music-[timestamp].wav')",
        "Both AI-generated music and beat sequencer patterns can be saved"
      ],
      "file_operations": [
        {
          "path": "frontend/src/components/MusicGenerator.tsx",
          "operation": "modify",
          "description": "Add a Save button to the interface that downloads the current audio (either generated music or beat pattern) as a WAV file with a timestamped filename (e.g., 'axora-music-[timestamp].wav'). For beat patterns, render the current pattern to an AudioBuffer using Web Audio API, convert to WAV blob, and trigger download. For AI-generated music, use the existing audio blob from useAudioGeneration."
        },
        {
          "path": "frontend/src/hooks/useAudioGeneration.ts",
          "operation": "modify",
          "description": "Expose the generated audio blob from the hook so it can be saved by the MusicGenerator component. Ensure the WAV conversion logic is reusable for both AI-generated music and beat sequencer patterns."
        }
      ]
    },
    {
      "id": "REQ-35",
      "summary": "Add Share button to MusicGenerator for generating shareable links",
      "acceptanceCriteria": [
        "A clearly labeled 'Share' button is visible in the MusicGenerator component interface",
        "Clicking the Share button uploads the audio data to the backend and returns a unique identifier",
        "The user receives a shareable URL that can be copied to clipboard",
        "Shared music can be played by anyone with the link without requiring authentication",
        "Both AI-generated music and beat sequencer patterns can be shared"
      ],
      "file_operations": [
        {
          "path": "frontend/src/components/MusicGenerator.tsx",
          "operation": "modify",
          "description": "Add a Share button that converts the current audio (AI-generated or beat pattern) to a WAV blob, creates an ExternalBlob using ExternalBlob.fromBytes(), generates a unique music ID, calls backend.shareMusic(musicId, externalBlob), and displays a shareable URL (e.g., '/shared/music/[musicId]') with a copy-to-clipboard button. Use the blob-storage component to handle the upload. Verify the component's usage instructions before implementing. Show loading state during upload and success/error feedback."
        },
        {
          "path": "frontend/src/hooks/useMusicShare.ts",
          "operation": "create",
          "description": "Create a custom hook that manages music sharing state and logic. Export functions for sharing music (converting audio to WAV blob, generating UUID, uploading via backend.shareMusic), copying share URL to clipboard, and managing loading/error states. Use React Query for mutation handling and the blob-storage ExternalBlob class for upload operations."
        }
      ]
    },
    {
      "id": "REQ-37",
      "summary": "Create viewer page for shared artwork and music with playback controls",
      "acceptanceCriteria": [
        "A dedicated route/page exists for viewing shared content by ID",
        "Shared artwork is displayed with proper image rendering",
        "Shared music includes playback controls (play, pause, volume)",
        "The viewer page works without requiring user authentication",
        "Error handling is implemented for invalid or non-existent share IDs"
      ],
      "file_operations": [
        {
          "path": "frontend/src/components/SharedContentViewer.tsx",
          "operation": "create",
          "description": "Create a viewer component that accepts a content type ('art' or 'music') and ID from URL parameters. For artwork, fetch via backend.retrieveArtwork() and display the image using ExternalBlob.getDirectURL(). For music, fetch via backend.retrieveMusic() and render an audio player with play/pause/volume controls using the blob's direct URL. Include loading states, error handling for invalid IDs, and responsive layout. Use the blob-storage component's getDirectURL() method to leverage streaming and caching."
        },
        {
          "path": "frontend/src/App.tsx",
          "operation": "modify",
          "description": "Add routes for '/shared/art/:artworkId' and '/shared/music/:musicId' that render the SharedContentViewer component with appropriate content type. These routes should be accessible without authentication and should not be wrapped in the authenticated layout. Use React Router's Route component to register these new routes."
        },
        {
          "path": "frontend/src/hooks/useSharedContent.ts",
          "operation": "create",
          "description": "Create a custom hook that fetches shared content (artwork or music) by ID using React Query. Export functions for fetching artwork (backend.retrieveArtwork) and music (backend.retrieveMusic), with proper error handling, loading states, and caching. Handle the ExternalBlob type returned from the backend and provide methods to get direct URLs for display."
        }
      ]
    }
  ]
}